var NodeType,__assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType||(NodeType={}));var _id=1;function genId(){return _id++}function getCssRulesString(e){try{var t=e.rules||e.cssRules;return t?Array.from(t).reduce(function(e,t){return e+getCssRuleString(t)},""):null}catch(e){return null}}function getCssRuleString(e){return isCSSImportRule(e)?getCssRulesString(e.styleSheet)||"":e.cssText}function isCSSImportRule(e){return"styleSheet"in e}function extractOrigin(e){return(e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0]).split("?")[0]}var URL_IN_CSS_REF=/url\((?:'([^']*)'|"([^"]*)"|([^)]*))\)/gm,RELATIVE_PATH=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/).*/,DATA_URI=/^(data:)([\w\/\+\-]+);(charset=[\w-]+|base64).*,(.*)/i;function absoluteToStylesheet(e,t){return e.replace(URL_IN_CSS_REF,function(e,n,r,o){var i=n||r||o;if(!i)return e;if(!RELATIVE_PATH.test(i))return"url('"+i+"')";if(DATA_URI.test(i))return"url("+i+")";if("/"===i[0])return"url('"+(extractOrigin(t)+i)+"')";var a=t.split("/"),s=i.split("/");a.pop();for(var u=0,c=s;u<c.length;u++){var l=c[u];"."!==l&&(".."===l?a.pop():a.push(l))}return"url('"+a.join("/")+"')"})}function getAbsoluteSrcsetString(e,t){return""===t.trim()?t:t.split(",").map(function(t){var n=t.trimLeft().trimRight().split(" ");return 2===n.length?absoluteToDoc(e,n[0])+" "+n[1]:1===n.length?""+absoluteToDoc(e,n[0]):""}).join(",")}function absoluteToDoc(e,t){if(""===t.trim())return t;var n=e.createElement("a");return n.href=t,n.href}function isSVGElement(e){return"svg"===e.tagName||e instanceof SVGElement}function serializeNode(e,t,n,r,o){switch(e.nodeType){case e.DOCUMENT_NODE:return{type:NodeType.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:NodeType.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId};case e.ELEMENT_NODE:var i=!1;"string"==typeof n?i=e.classList.contains(n):e.classList.forEach(function(e){n.test(e)&&(i=!0)});for(var a=e.tagName.toLowerCase(),s={},u=0,c=Array.from(e.attributes);u<c.length;u++){var l=c[u],d=l.name,p=l.value;s[d]="src"===d||"href"===d?absoluteToDoc(t,p):"srcset"==d?getAbsoluteSrcsetString(t,p):"style"===d?absoluteToStylesheet(p,location.href):p}if("link"===a&&r){var m,v=Array.from(t.styleSheets).find(function(t){return t.href===e.href});(m=getCssRulesString(v))&&(delete s.rel,delete s.href,s._cssText=absoluteToStylesheet(m,v.href))}if("style"===a&&e.sheet&&!(e.innerText||e.textContent||"").trim().length)(m=getCssRulesString(e.sheet))&&(s._cssText=absoluteToStylesheet(m,location.href));if("input"===a||"textarea"===a||"select"===a){p=e.value;"radio"!==s.type&&"checkbox"!==s.type&&p?s.value=o?"*".repeat(p.length):p:e.checked&&(s.checked=e.checked)}if("option"===a){var f=e.parentElement;s.value===f.value&&(s.selected=e.selected)}if("canvas"===a&&(s.rr_dataURL=e.toDataURL()),i){var h=e.getBoundingClientRect(),y=h.width,g=h.height;s.rr_width=y+"px",s.rr_height=g+"px"}return{type:NodeType.Element,tagName:a,attributes:s,childNodes:[],isSVG:isSVGElement(e)||void 0,needBlock:i};case e.TEXT_NODE:var E=e.parentNode&&e.parentNode.tagName,T=e.textContent,b="STYLE"===E||void 0;return b&&T&&(T=absoluteToStylesheet(T,location.href)),"SCRIPT"===E&&(T="SCRIPT_PLACEHOLDER"),{type:NodeType.Text,textContent:T||"",isStyle:b};case e.CDATA_SECTION_NODE:return{type:NodeType.CDATA,textContent:""};case e.COMMENT_NODE:return{type:NodeType.Comment,textContent:e.textContent||""};default:return!1}}function serializeNodeWithId(e,t,n,r,o,i,a){void 0===o&&(o=!1),void 0===i&&(i=!0),void 0===a&&(a=!1);var s,u=serializeNode(e,t,r,i,a);if(!u)return console.warn(e,"not serialized"),null;s="__sn"in e?e.__sn.id:genId();var c=Object.assign(u,{id:s});e.__sn=c,n[s]=e;var l=!o;if(c.type===NodeType.Element&&(l=l&&!c.needBlock,delete c.needBlock),(c.type===NodeType.Document||c.type===NodeType.Element)&&l)for(var d=0,p=Array.from(e.childNodes);d<p.length;d++){var m=serializeNodeWithId(p[d],t,n,r,o,i,a);m&&c.childNodes.push(m)}return c}function snapshot(e,t,n,r){void 0===t&&(t="rr-block"),void 0===n&&(n=!0),void 0===r&&(r=!1);var o={};return[serializeNodeWithId(e,e,o,t,!1,n,r),o]}function on(e,t,n){void 0===n&&(n=document);var r={capture:!0,passive:!0};return n.addEventListener(e,t,r),function(){return n.removeEventListener(e,t,r)}}var EventType,IncrementalSource,MouseInteractions,ReplayerEvents,mirror={map:{},getId:function(e){return e.__sn?e.__sn.id:-1},getNode:function(e){return mirror.map[e]||null},removeNodeFromMap:function(e){var t=e.__sn&&e.__sn.id;delete mirror.map[t],e.childNodes&&e.childNodes.forEach(function(e){return mirror.removeNodeFromMap(e)})},has:function(e){return mirror.map.hasOwnProperty(e)}};function throttle(e,t,n){void 0===n&&(n={});var r=null,o=0;return function(i){var a=Date.now();o||!1!==n.leading||(o=a);var s=t-(a-o),u=this,c=arguments;s<=0||s>t?(r&&(window.clearTimeout(r),r=null),o=a,e.apply(u,c)):r||!1===n.trailing||(r=window.setTimeout(function(){o=!1===n.leading?0:Date.now(),r=null,e.apply(u,c)},s))}}function hookSetter(e,t,n,r){var o=Object.getOwnPropertyDescriptor(e,t);return Object.defineProperty(e,t,r?n:{set:function(e){var t=this;setTimeout(function(){n.set.call(t,e)},0),o&&o.set&&o.set.call(this,e)}}),function(){return hookSetter(e,t,o||{},!0)}}function getWindowHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function getWindowWidth(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function isBlocked(e,t){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){var n=!1;return"string"==typeof t?n=e.classList.contains(t):e.classList.forEach(function(e){t.test(e)&&(n=!0)}),n||isBlocked(e.parentNode,t)}return isBlocked(e.parentNode,t)}function isAncestorRemoved(e){var t=mirror.getId(e);return!mirror.has(t)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||isAncestorRemoved(e.parentNode))}function isTouchEvent(e){return Boolean(e.changedTouches)}function polyfill(){"NodeList"in window&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach)}function deepDelete(e,t){e.delete(t),t.childNodes.forEach(function(t){return deepDelete(e,t)})}function isParentRemoved(e,t){var n=t.parentNode;if(!n)return!1;var r=mirror.getId(n);return!!e.some(function(e){return e.id===r})||isParentRemoved(e,n)}function isAncestorInSet(e,t){var n=t.parentNode;return!!n&&(!!e.has(n)||isAncestorInSet(e,n))}!function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom"}(EventType||(EventType={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove"}(IncrementalSource||(IncrementalSource={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd"}(MouseInteractions||(MouseInteractions={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction"}(ReplayerEvents||(ReplayerEvents={}));var moveKey=function(e,t){return e+"@"+t};function isINode(e){return"__sn"in e}function initMutationObserver(e,t,n,r){var o=new MutationObserver(function(o){var i=[],a=[],s=[],u=[],c=new Set,l=new Set,d=new Set,p={},m=function(e,n){if(!isBlocked(e,t)){if(isINode(e)){l.add(e);var r=null;n&&isINode(n)&&(r=n.__sn.id),r&&(p[moveKey(e.__sn.id,r)]=!0)}else c.add(e),d.delete(e);e.childNodes.forEach(function(e){return m(e)})}};o.forEach(function(e){var n=e.type,r=e.target,o=e.oldValue,u=e.addedNodes,v=e.removedNodes,f=e.attributeName;switch(n){case"characterData":var h=r.textContent;isBlocked(r,t)||h===o||i.push({value:h,node:r});break;case"attributes":h=r.getAttribute(f);if(isBlocked(r,t)||h===o)return;var y=a.find(function(e){return e.node===r});y||(y={node:r,attributes:{}},a.push(y)),y.attributes[f]=h;break;case"childList":u.forEach(function(e){return m(e,r)}),v.forEach(function(e){var n=mirror.getId(e),o=mirror.getId(r);isBlocked(e,t)||(c.has(e)?(deepDelete(c,e),d.add(e)):c.has(r)&&-1===n||isAncestorRemoved(r)||(l.has(e)&&p[moveKey(n,o)]?deepDelete(l,e):s.push({parentId:o,id:n})),mirror.removeNodeFromMap(e))})}});for(var v=[],f=function(e){var o=mirror.getId(e.parentNode);if(-1===o)return v.push(e);u.push({parentId:o,previousId:e.previousSibling?mirror.getId(e.previousSibling):e.previousSibling,nextId:e.nextSibling?mirror.getId(e.nextSibling):e.nextSibling,node:serializeNodeWithId(e,document,mirror.map,t,!0,n,r)})},h=l.values(),y=null;y=h.next().value;)f(y);for(h=c.values(),y=null;y=h.next().value;)isAncestorInSet(d,y)||isParentRemoved(s,y)?isAncestorInSet(l,y)?f(y):d.add(y):f(y);for(;v.length&&!v.every(function(e){return-1===mirror.getId(e.parentNode)});)f(v.shift());var g={texts:i.map(function(e){return{id:mirror.getId(e.node),value:e.value}}).filter(function(e){return mirror.has(e.id)}),attributes:a.map(function(e){return{id:mirror.getId(e.node),attributes:e.attributes}}).filter(function(e){return mirror.has(e.id)}),removes:s,adds:u};(g.texts.length||g.attributes.length||g.removes.length||g.adds.length)&&e(g)});return o.observe(document,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),o}function initMoveObserver(e){var t,n=[],r=throttle(function(r){var o=Date.now()-t;e(n.map(function(e){return e.timeOffset-=o,e}),r?IncrementalSource.TouchMove:IncrementalSource.MouseMove),n=[],t=null},500),o=throttle(function(e){var o=e.target,i=isTouchEvent(e)?e.changedTouches[0]:e,a=i.clientX,s=i.clientY;t||(t=Date.now()),n.push({x:a,y:s,id:mirror.getId(o),timeOffset:Date.now()-t}),r(isTouchEvent(e))},50,{trailing:!1}),i=[on("mousemove",o),on("touchmove",o)];return function(){i.forEach(function(e){return e()})}}function initMouseInteractionObserver(e,t){var n=[];return Object.keys(MouseInteractions).filter(function(e){return Number.isNaN(Number(e))&&!e.endsWith("_Departed")}).forEach(function(r){var o=r.toLowerCase(),i=function(n){return function(r){if(!isBlocked(r.target,t)){var o=mirror.getId(r.target),i=isTouchEvent(r)?r.changedTouches[0]:r,a=i.clientX,s=i.clientY;e({type:MouseInteractions[n],id:o,x:a,y:s})}}}(r);n.push(on(o,i))}),function(){n.forEach(function(e){return e()})}}function initScrollObserver(e,t){return on("scroll",throttle(function(n){if(n.target&&!isBlocked(n.target,t)){var r=mirror.getId(n.target);if(n.target===document){var o=document.scrollingElement||document.documentElement;e({id:r,x:o.scrollLeft,y:o.scrollTop})}else e({id:r,x:n.target.scrollLeft,y:n.target.scrollTop})}},100))}function initViewportResizeObserver(e){return on("resize",throttle(function(){var t=getWindowHeight(),n=getWindowWidth();e({width:Number(n),height:Number(t)})},200),window)}var wrappedEmit,INPUT_TAGS=["INPUT","TEXTAREA","SELECT"],MASK_TYPES=["color","date","datetime-local","email","month","number","range","search","tel","text","time","url","week"],lastInputValueMap=new WeakMap;function initInputObserver(e,t,n,r){function o(e){var o=e.target;if(o&&o.tagName&&!(INPUT_TAGS.indexOf(o.tagName)<0)&&!isBlocked(o,t)){var a=o.type;if("password"!==a&&!o.classList.contains(n)){var s=o.value,u=!1,c=MASK_TYPES.includes(a)||"TEXTAREA"===o.tagName;"radio"===a||"checkbox"===a?u=o.checked:c&&r&&(s="*".repeat(s.length)),i(o,{text:s,isChecked:u});var l=o.name;"radio"===a&&l&&u&&document.querySelectorAll('input[type="radio"][name="'+l+'"]').forEach(function(e){e!==o&&i(e,{text:e.value,isChecked:!u})})}}}function i(t,n){var r=lastInputValueMap.get(t);if(!r||r.text!==n.text||r.isChecked!==n.isChecked){lastInputValueMap.set(t,n);var o=mirror.getId(t);e(__assign(__assign({},n),{id:o}))}}var a=["input","change"].map(function(e){return on(e,o)}),s=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),u=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"]];return s&&s.set&&a.push.apply(a,u.map(function(e){return hookSetter(e[0],e[1],{set:function(){o({target:this})}})})),function(){a.forEach(function(e){return e()})}}function mergeHooks(e,t){var n=e.mutationCb,r=e.mousemoveCb,o=e.mouseInteractionCb,i=e.scrollCb,a=e.viewportResizeCb,s=e.inputCb;e.mutationCb=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.mutation&&t.mutation.apply(t,e),n.apply(void 0,e)},e.mousemoveCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mousemove&&t.mousemove.apply(t,e),r.apply(void 0,e)},e.mouseInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mouseInteraction&&t.mouseInteraction.apply(t,e),o.apply(void 0,e)},e.scrollCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.scroll&&t.scroll.apply(t,e),i.apply(void 0,e)},e.viewportResizeCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.viewportResize&&t.viewportResize.apply(t,e),a.apply(void 0,e)},e.inputCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.input&&t.input.apply(t,e),s.apply(void 0,e)}}function initObservers(e,t){void 0===t&&(t={}),mergeHooks(e,t);var n=initMutationObserver(e.mutationCb,e.blockClass,e.inlineStylesheet,e.maskAllInputs),r=initMoveObserver(e.mousemoveCb),o=initMouseInteractionObserver(e.mouseInteractionCb,e.blockClass),i=initScrollObserver(e.scrollCb,e.blockClass),a=initViewportResizeObserver(e.viewportResizeCb),s=initInputObserver(e.inputCb,e.blockClass,e.ignoreClass,e.maskAllInputs);return function(){n.disconnect(),r(),o(),i(),a(),s()}}function wrapEvent(e){return __assign(__assign({},e),{timestamp:Date.now()})}function record(e){void 0===e&&(e={});var t,n=e.emit,r=e.checkoutEveryNms,o=e.checkoutEveryNth,i=e.blockClass,a=void 0===i?"rr-block":i,s=e.ignoreClass,u=void 0===s?"rr-ignore":s,c=e.inlineStylesheet,l=void 0===c||c,d=e.maskAllInputs,p=void 0!==d&&d,m=e.hooks;if(!n)throw new Error("emit function is required");polyfill();var v=0;function f(e){void 0===e&&(e=!1),wrappedEmit(wrapEvent({type:EventType.Meta,data:{href:window.location.href,width:getWindowWidth(),height:getWindowHeight()}}),e);var t=snapshot(document,a,l,p),n=t[0],r=t[1];if(!n)return console.warn("Failed to snapshot the document");mirror.map=r,wrappedEmit(wrapEvent({type:EventType.FullSnapshot,data:{node:n,initialOffset:{left:document.documentElement.scrollLeft,top:document.documentElement.scrollTop}}}))}wrappedEmit=function(e,i){if(n(e,i),e.type===EventType.FullSnapshot)t=e,v=0;else if(e.type===EventType.IncrementalSnapshot){v++;var a=o&&v>=o,s=r&&e.timestamp-t.timestamp>r;(a||s)&&f(!0)}};try{var h=[];h.push(on("DOMContentLoaded",function(){wrappedEmit(wrapEvent({type:EventType.DomContentLoaded,data:{}}))}));var y=function(){f(),h.push(initObservers({mutationCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.Mutation},e)}))},mousemoveCb:function(e,t){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:{source:t,positions:e}}))},mouseInteractionCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.MouseInteraction},e)}))},scrollCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.Scroll},e)}))},viewportResizeCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.ViewportResize},e)}))},inputCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.Input},e)}))},blockClass:a,ignoreClass:u,maskAllInputs:p,inlineStylesheet:l},m))};return"interactive"===document.readyState||"complete"===document.readyState?y():h.push(on("load",function(){wrappedEmit(wrapEvent({type:EventType.Load,data:{}})),y()},window)),function(){h.forEach(function(e){return e()})}}catch(e){console.warn(e)}}record.addCustomEvent=function(e,t){if(!wrappedEmit)throw new Error("please add custom event after start recording");wrappedEmit(wrapEvent({type:EventType.Custom,data:{tag:e,payload:t}}))};export default record;
//# sourceMappingURL=rrweb-record.min.js.map
